<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GitHub Pages DWG Viewer</title>

<script src="https://cdn.jsdelivr.net/npm/three@0.152/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dwg-viewer@1.2.0/dist/dwg-viewer.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#eee;
}

.header{
    background:#222;
    color:white;
    padding:10px;
    text-align:center;
}

#viewer{
    width:100vw;
    height:calc(100vh - 60px);
}

#uploadBox{
    position:fixed;
    top:70px;
    left:10px;
    background:white;
    padding:10px;
    border-radius:6px;
    box-shadow:0 0 5px rgba(0,0,0,.3);
}
</style>
</head>

<body>

<div class="header">
<h3>DWG Viewer (Works on GitHub Pages)</h3>
</div>

<div id="uploadBox">
<input type="file" id="fileInput" accept=".dwg,.dxf">
<p id="status">Upload a DWG file</p>
</div>

<div id="viewer"></div>

<script>
let container = document.getElementById("viewer");
let status = document.getElementById("status");

const scene = new THREE.Scene();
scene.background = new THREE.Color(0xffffff);

const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 10000);
camera.position.set(0, 0, 500);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight-60);
container.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);

function animate(){
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
}
animate();

window.addEventListener("resize", ()=>{
    camera.aspect = window.innerWidth/(window.innerHeight-60);
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight-60);
});

document.getElementById("fileInput").addEventListener("change", async (e)=>{
    const file = e.target.files[0];
    if(!file) return;

    status.innerText = "Loading " + file.name + " ...";

    const reader = new FileReader();

    reader.onload = function(evt){
        try{
            const loader = new DWGLoader();
            loader.parse(evt.target.result, (model)=>{
                scene.add(model);
                status.innerText = "Loaded: " + file.name;
            });
        }
        catch(err){
            status.innerText = "Load error: " + err.message;
            console.error(err);
        }
    };

    reader.readAsArrayBuffer(file);
});
</script>

</body>
</html>
