<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Browser DWG Viewer</title>

<!-- ODA WebViewer (client-side DWG engine) -->
<script src="https://webviewer.opendesign.com/oda.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    background:#f2f2f2;
}

.header{
    background:#1e1e1e;
    color:white;
    padding:10px;
    text-align:center;
}

.container{
    display:flex;
    height:calc(100vh - 60px);
}

.sidebar{
    width:260px;
    background:#ffffff;
    padding:10px;
    border-right:1px solid #ddd;
    box-shadow:2px 0 5px rgba(0,0,0,0.1);
}

.viewer{
    flex:1;
    position:relative;
}

#viewerDiv{
    width:100%;
    height:100%;
}

button, input{
    width:100%;
    margin:6px 0;
    padding:8px;
}

.status{
    font-size:12px;
    color:#006600;
}
</style>
</head>

<body>

<div class="header">
<h2>üìê Web DWG Viewer (Upload & View)</h2>
</div>

<div class="container">

<div class="sidebar">
<label><b>Select DWG File:</b></label>
<input type="file" id="fileInput" accept=".dwg,.dxf"/>

<button onclick="fitToScreen()">Fit to Screen</button>
<button onclick="resetView()">Reset View</button>

<hr>

<div id="status" class="status">
Waiting for file...
</div>
</div>

<div class="viewer">
<div id="viewerDiv"></div>
</div>

</div>

<script>
let viewer = null;

async function initViewer(){
    viewer = await ODA.initialize({
        container: "viewerDiv",
        backgroundColor: [255,255,255,255]
    });

    document.getElementById("status").innerText = "Viewer ready. Upload a DWG file.";
}

initViewer();

document.getElementById("fileInput").addEventListener("change", async function(event){
    const file = event.target.files[0];
    if(!file) return;

    document.getElementById("status").innerText = "Loading " + file.name + " ...";

    const arrayBuffer = await file.arrayBuffer();

    try{
        await viewer.loadFromArrayBuffer(arrayBuffer, file.name);
        document.getElementById("status").innerText = "Loaded: " + file.name;
    }catch(e){
        document.getElementById("status").innerText = "Error loading file!";
        console.error(e);
    }
});

function fitToScreen(){
    if(viewer) viewer.fitToScreen();
}

function resetView(){
    if(viewer) viewer.resetView();
}
</script>

</body>
</html>
